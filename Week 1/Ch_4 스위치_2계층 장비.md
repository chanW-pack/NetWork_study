# Ch_4 스위치: 2계층 장비

---

2.3 스위치 절에서 학습한 것처럼 네트워크의 가장 핵심장비인 스위치는 2계층 주소인 MAC 주소를 기반으로 동작한다.

![Untitled](Ch_4%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%20b1b4e/Untitled.png)

> 스위치는 2계층으로 통신한다.
> 

스위치는 네트워크 중간에서 패킷을 받아 필요한 곳에만 보내주는 **네트워크의 중재자 역할**을 한다. 스위치는 아무 설정 없이 네트워크에 연결해도 **MAC 주소를 기반으로 패킷을 전달**하는 기본 동작을 수행할 수 있다.

이 기본 동작 이외에도 다음 동작이 가능하다.

- VLAN 기능: 한 대의 장비에서 논리적으로 네트워크를 분리하는 기능
- 스패닝 트리 프로토콜(STP): 네트워크의 루프를 방지하는 기능
- 그 밖의 다양한 보안 기능과 모니터링에 필요한 여러 기능

# 4.1 스위치 장비 동작

스위치가 없던 오래된 이더넷 네트워크에서는 패킷을 전송할 때 서로 경합해 그로 인한 네트워크 성능 저하가 컸다.

이런 경쟁을 없애고 패킷을 동시에 여러 장비가 **서로 간섭 없이 통신하도록 도와주는 장비**가 스위치이다.

<aside>
💡 스위치를 이용하면 여러 단말이 한꺼번에 통신할 수 있어 통신하기 위해 기다리거나 충돌 때문에 대기하는 문제가 해결되고 네트워크 전체의 통신 효율성이 향상된다.

</aside>

**스위치의 핵심 역할은 누가 어느 위치에 있는지 파악하고 패킷을 알고 있는 위치로 정확히 전송하는 것이다.**

스위치는 **MAC 주소 테이블**을 가지고 있다.

MAC 주소 테이블은 MAC 주소와 단말이 위치하는 인터페이스 정보를 매핑한 것으로 스위치의 역할을 가능하게 한다.

스위치는 전송하려는 패킷의 헤더 안에 있는 2계층 목적지 주소를 확인하고 MAC 주소 테이블에서 해당 주소가 어느 포트에 있는지 확인해 해당 패킷을 그 포트로만 전송한다.

만약 테이블에 없는 도착지 주소를 가진 패킷이 스위치로 들어오면 스위치는 **전체 포트로 패킷을 전송**한다.

이런 식으로 테이블 상태에 따라 다르게 동작하는 스위치의 동작을 크게 세 가지로 나누어 볼 수 있다.

1. 플러딩(Flooding)
2. 어드레스 러닝(Address Learning)
3. 포워드/필터링(Forwarding/Filtering)

---

## 플러딩

**1. 부팅 시**

스위치는 부팅하면 네트워크 관련 정보가 아무 것도 없다.

이때 스위치는 네트워크 통신 중재 역할을 하지 못하고 허브처럼 동작하게 된다. 즉 허브처럼 패킷이 들어온 포트를 제외하고 모든 포트로 패킷을 전달한다.

이처럼 스위치가 허브처럼 모든 패킷을 흘리는 동작 방식을 **플러딩**이라고 한다.

**2. 정보 부재 시**

패킷이 들어오면 도착지 MAC 주소를 확인하고 MAC 주소 테이블에서 해당 MAC 주소가 있는지 확인한다.

MAC 주소 테이블에 매칭되는 목적지 MAC 주소 정보가 없으면 플러딩해줍니다. 스위치는 LAN에서 동작하므로 자신이 정보를 갖고 있지 않더라도 어딘가에 장비가 있을 수 있다고 가정하고 이와 같은 작업을 수행한다.

이런 플러딩 동작은 스위치의 정상적인 동작이지만 이런 동작이 많아지면 스위치가 제 역할을 못하게 된다.

스위치는 패킷이 들어오면 패킷 정보의 MAC 주소를 보고 이를 학습해 MAC 주소 테이블을 만든 후 이를 통해 패킷을 전송합니다.

### 비정상적인 플러딩

이더넷-TCP/IP 네트워크에서는 ARP 브로드캐스트를 미리 주고받은 후 데이터가 전달되므로 실제로 데이터를 보내고 받을 때는 스위치가 패킷을 플러딩하지 않는다.

<aside>
☝ 스위치를 사용하면 필요한 곳에만 패킷을 포워딩하므로 주변 통신을 악의적으로 가로채기 힘들어 모든 패킷을 플러딩하는 허브에 비해 보안에 도움이 된다.

</aside>

이런 스위치 기능을 무력화해 주변 통신을 모니터링하는 공격 기법이 사용된다.

- 스위치에 엉뚱한 MAC 주소를 습득시키기
- 스위치에 MAC 테이블을 꽉 차게해 스위치의 플러딩 유도

즉 아무 이유없이 스위치가 패킷을 플러딩한다면 스위치가 정상적으로 동작하지 않거나 주변에서 공격이 수행되는 상황임으 알아야 한다.

> 이 외에도 ARP 포이즈닝 기법을 이용해 모니터링해야할 IP의 MAC 주소가 공격자 자신인 것처럼 속여 원하는 통신을 받는 방법을 사용하기도 한다.
> 

---

## 어드레스 러닝

스위치가 패킷의 도착지 MAC 주소를 확인하여 원하는 포트로 포워딩하는 스위치의 동작을 정상적으로 수행하려면 MAC 주소 테이블을 만들고 유지해야 한다.

이런 **MAC 주소 테이블을 만들고 유지하는 과정**을 어드레스 러닝이라고 한다.

<aside>
💡 어드레스 러닝은 패킷의 출발지 MAC 주소 정보를 이용한다.

</aside>

패킷이 특정 포트에 들어오면 스위치에는 해당 패킷의 **출발지 MAC 주소와 포트 번호**를 MAC 주소 테이블에 기록한다.

어드레스 러닝은 출발지의 MAC 주소를 통해 학습하므로 브로드캐스트나 멀티캐스트 시에 사용되는 목적지 MAC 주소를 학습할 수 없다. 이들의 MAC 주소는 목적지 MAC 주소 필드에만 사용되기 때문이다.

<aside>
📢 사전에 정의된 MAC 주소 테이블

</aside>

스위치는 MAC 어드레스 러닝 작업으로 주변 장비의 MAC 주소를 학습하는 것 외에도 사전에 미리 정의된 MAC 주소 정보를 가지고 있다.

이런 사전 정의된 주소는 패킷 처리를 위한 주소가 아닌 스위치간 통신을 위해 사용되는 주소이다.

스위치에서 자체 처리되는 주소는 특정 포트로 내보내는 것이 아니라 스위치에서 자체 처리하므로 인접 포트 정보가 없거나 CPU 혹은 관리 모듈을 지칭하는 용어로 표기된다.

스위치에서 MAC 주소 테이블을 보기 위한 show mac address-table 명령어를 사용한다.

---

## 포워딩/필터링

스위치는 패킷이 들어온 경우 도착지 MAC 주소를 확인하고 자신의 MAC 주소 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 패킷을 **포워딩**한다.

이때 다른 포트로는 해당 패킷을 보내지 않으므로 이 동작을 **필터링**이라고 한다.

스위치는 이런 포워딩과 필터링을 통해 목적지로만 패킷이 전달되도록 동작한다.

스위치에서는 포워딩과 필터링 작업이 여러 포트에서 동시에 수행될 수 있다. 통신이 다른 포트에 영향을 미치지 않으므로 다른 포트에서 기존 통신 작업으로부터 독립적으로 동작할 수 있다.

<aside>
🐓 스위치는 일반적인 유니캐스트에서만 포워딩/필터링 작업을 수행한다.

</aside>

BUM 트래픽이라 부르는 브로드캐스트와 언노운 유니캐스트, 멀티캐스트는 조금 다르게 동작한다.

브로드캐스트와 멀티캐스트 모두 필터링 작업을 하지 않고 모두 플러딩한다. 또한 언노운 유니캐스트도 MAC 주소 테이블에 없는 주소이므로 브로드캐스트와 동일하게 플러딩 동작한다.

---

### LAN에서의 ARP - 스위치 동작

이전에 학습했듯이, 이더넷-TCP/IP 네트워크에선 스위치가 유니캐스트를 플러딩하는 경우는 거의 없다.

패킷을 만들기 전에 통신해야 하는 단말의 MAC 주소를 알아내기 위해 ARP 브로드캐스트가 먼저 수행되어야 하므로 유니캐스트보다 ARP 브로드캐스트가 먼저 네트워크에 전달된다.

이 ARP를 이용한 MAC 주소 습득 과정에서 이미 스위치는 통신하는 출발지와 목적지 MAC 주소를 습득할 수 있고 실제 유니캐스트 통신이 시작되면 이미 만들어진 MAC 주소 테이블로 패킷을 포워딩, 필터링 한다.

ARP와 MAC 테이블은 일정 시간 동안 지워지지 않는데 이 시간을 에이징 타임(Aging Time)이라고 한다.

일반적으로 MAC 테이블의 에이징 타임이 ARP 에이징 타임보다 길어 이더넷 네트워크를 플러딩 없이 효율적으로 운영할 수 있다.

---

# 4.2 VLAN

VLAN(Virtual Local Area Network)는 하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있는 기술이다.

한 대의 스위치를 여러 개의 VLAN으로 분할할 수 있고 별도의 스위처럼 동작한다.

### VLAN이란

VLAN은 물리적 배치와 상관 없이 **LAN을 논리적으로 분할, 구성**하는 기술이다.

최근엔 전화기, 복합기, 스마트폰과 같이 PC 외에도 다수의 단말이 네트워크에 연결되기 때문에 네트워크 분할이 더 중요하다.

과도한 브로드캐스트로 인한 단말들의 성능 저하, 보안 향상을 위한 차단 용도, 서비스 성격에 따른 정책 적용과 같은 이유도 있다.

<aside>
🦊 VLAN을 사용하면 물리적 구성과 상관없이 네트워크를 분리할 수 있고, 물리적으로 다른 층에 있는 단말이 하나의 VLAN을 사용해 동일한 네트워크를 묶을 수 있다.

</aside>

같은 층에서 부서별로 네트워크를 분리하거나 일반 PC, IP 전화기, 무선 단말과 같이 서비스나 단말의 성격에 따라 네트워크를 분리할 수 있다. 그리고 이렇게 분리된 단말 간에는 3계층 장비를 통해 통신해야 한다.

> VLAN을 나누면 하나의 장비를 서로 다른 네트워크를 갖도록 논리적으로 분할한 것이므로 유니캐스트 뿐만 아니라 브로드캐스트도 VLAN 간에 통신할 수 없다.
> 

> VLAN 간의 통신이 필요하다면 서로 다른 네트워크 간의 통신이므로 앞서 배운 것처럼 3계층 장비가 필요하다.
> 

---

### VLAN의 종류와 특징

VLAN의 할당 방식에는 **포트 기반**의 VLAN과 **MAC 주소 기반**의 VLAN이 있다.

**포트 기반 VLAN**

VLAN 개념이 처음 도입되었을 때는 스위치가 고가였고, 여러 허브를 묶는 역할을 스위치가 담당했으므로 스위치를 분할해 여러 네트워크에 사용하는 것이 VLAN기능을 적용하는 목적이었다.

이렇게 스위치를 논리적으로 분할해 사용하는 것이 목적인 VLAN을 **포트 기반 VLAN(Port Based VLAN)** 이라고 부르고 일반적으로 언급하는 대부분의 VLAN은 포트 기반 VLAN에 속하게 된다.

어떤 단말이 접속하든지 스위치에 특정 포트에 VLAN을 할당하면 할당된 VLAN에 속하게 된다.

*포트 1: VLAN 10, 포트 2: VLAN20 으로 할당되었을 때, 한 PC가 포트 1에 연결하면 VLAN 10에 속하고, 포트 2에 연결하면 VLAN 20에 속한다.*

**MAC 기반 VLAN**

사용자들의 자리 이동이 많아지면서 **MAC 기반 VLAN(Mac Based VLAN)** 이 개발되었다.

스위치를 고정 포트에 VLAN을 할당하는 것이 아니라 스위치에 연결되는 단말의 MAC 주소를 기반으로 VLAN을 할당하는 기술이다.

단말이 연결되면 단말의 MAC 주소를 인식한 스위치가 해당 포트를 지정된 VLAN으로 변경한다.

단말에 따라 VLAN 정보가 바뀔 수 있어 다이나믹 VLAN(Dynamic VLAN)이라고도 부른다.

*MAC 주소가 AA인 경우, VLAN 10을 할당한다. 그렇다면 어떤 포트에 연결하든지 VLAN 10에 속하게 된다.*

---

### VLAN 모드(Trunk/Access) 동작 방식

스위치 포트에 VLAN을 설정하여 네트워크를 분리하면 물리적으로 스위치를 분리할 때보다 효율적으로 장비를 사용할 수 있다.

여러 개의 VLAN이 존재하는 상황에서 스위치를 서로 연결해야 하는 경우에는 각 VLAN끼리 통신하려먼 VLAN 개수만큼 포트를 연결해야 한다.

<aside>
💡 만약 스위치에 3개의 VLAN이 존재한다면 VLAN 간의 통신을 위해 3개의 포트가 필요하다.

</aside>

VLAN을 더 많이 사용하는 중.대형 네트워크에서 이렇게 VLAN 별로 포트를 연결하면 장비 간의 연결만으로도 많은 포트가 낭비된다.

**이 문제를 해결하기 위한 것이 VLAN 태그 기능이다**

태그 기능은 하나의 포트에 여러 개의 VLAN을 함께 전송할 수 있게 해준다.

이 포트를 **태그 포트(Tagged Port)** 또는 **트렁크 포트(Truck Port)**라고 한다.

여러 개의 VLAN을 동시에 전송해야 하는 태그 포트는 통신할 때 이더넷 프레임 중간에 VLAN ID 필드를 끼워 넣어 이 정보를 이용한다.

태그 포트로 패킷을 보낼 때는 VLAN ID를 붙이고 수신 측에서는 이 VLAN ID를 제거하면서 VLAN ID의 VLAN으로 패킷을 보낼 수 있게 됩니다.

<aside>
📌 **스위치 간 VLAN 정보를 보낼 수 있는 포트**의 일반적인 용어는 ‘**태크 포트**’ 이다. **트렁크 포트**는 **시스코에서 사용하는 명칭**으로, 트렁크라는 용어를 다른 네트워크 장비 제조사에서 다른 의미로 사용하므로 문맥으로 이것을 잘 파악해야 한다. 타 제조사에서는 트렁크 포트를 여러 개의 포트를 묶어 사용하기 위한 링크 애그리게이션의 의미로 사용한다.

</aside>

태그 포트를 사용하면 VLAN 마다 통신을 위해 필요했던 포트를 하나로 묶어 사용할 수 있으므로 포트 낭비 없이 네트워크를 더 유연하게 디자인할 수 있다.

**이런 태그 포트의 기능이 생기면서 스위치의 패킷 전송에 사용하는 MAC 주소 테이블에도 변화가 생긴다.**

다른 VLAN끼리 통신하지 못하도록 MAC 테이블에 VLAN을 지정하는 필드가 추가되었다.

즉, 하나의 스위치에서 VLAN을 이용해 네트워크를 분리하면 VLAN 별로 MAC 주소 테이블이 존재하는 것처럼 동작한다.

일반적인 포트를 언태그 포트(Untagged Port) 또는 액세스 포트(Access Port)라고 하고 여러 VLAN이 한꺼번에 통신하도록 해주는 포트를 태그 포트 또는 트렁크 포트라 한다.

- 태그 포트: 여러 네트워크를 하나의 물리적인 포트로 전달하는데 사용
- 언태그 포트: 하나의 VLAN에 속한 경우에만 사용

일반적으로 태그 포트는 여러 네트워크가 동시에 설정된 스위치 간의 연결에서 사용되며 하나의 네트워크에 속한 서버의 경우에는 언태그로 설정한다.

- 언태그 포트로 패킷이 들어온 경우, 같은 VLAN으로만 패킷을 전송한다.
- 태그 포트로 패킷이 들어온 경우, 태그를 벗겨내면서 태그된 VLAN 쪽으로 패킷을 전송한다.

**스위치 간의 연결이 아닌 서버와 연결된 포트도 VMware의 ESXi와 같은 가상화 서버가 연결될 때는 여러 VLAN과 통신해야 할 수 도 있다.**

이 경우, 서버와 연결된 스위치의 포트더라도 언태그 포트가 아닌 태그로 설정한다.

가상화 서버 쪽 인터페이스에도 태그된 상태로 설정해야 한다.

가상화 서버 내부에 가상 스위치가 존재하므로 스위치 간 연결로 보면 더 쉽다.

### VLAN 간 통신

유니캐스트, 브로드캐스트, 멀티캐스트 모두 VLAN을 넘어가지 못한다.

VLAN이 다른 것은 다른 네트워크, 다른 IP 주소이기 때문에 L3 장비의 도움이 필요하다.

---

# 4.3 STP

네트워크를 스위치 하나도 구성했을 때, 그 스위치에 장애가 발생하면 전체 네트워크에 장애가 발생한다.

이처럼 하나의 구성 요소에서 고장이 발생했을 때 전체 시스템의 작동이 멈추는 요소를 SPoF(Single Point of Failure, 단일 장애점)이라고 한다.

네트워크에선 이런 경우를 피하기 위해 이중화, 다중화된 네트워크를 디자인하고 구성한다.

이런 경우를 피하기 위해 두 대의 스위치로 디자인하지만 두 대 이상의 스위치로 디자인하면 패킷이 네트워크를 따라 계속 전송되므로 네트워크를 마비시킬 수 있다.

이런 상황을 Loop라 한다.

### 루프란?

루프란 네트워크에 연결된 모양이 고리처럼 되돌아오는 형태로 구성된 상황을 말한다.

루프 상황이 발생했을 때, 네트워크가 마비되고 통신이 안 되는 상황이 발생한다.

루프로 인한 문제가 발생했다면 대부분 브로드캐스트 스톰으로 인한 문제이다.

---

### 브로드캐스트 스톰

루프 구조로 네트워크가 연결된 상태에서 단말이 브로드캐스트를 발생시키면 스위치는 이 패킷을 발신지 포트를 제외한 모든 포트로 플러딩한다.

플러딩된 패킷은 다른 스위치로도 보내지고 이 패킷을 받은 스위치 또한 플러딩한다.

루프 구조 상태에서는 이 패킷이 계속 돌아가는데 이것을 **브로드캐스트 스톰**이라 한다.

브로드캐스트 스톰이 발생하면 나타나는 증상으로는,

1. 네트워크에 접속된 단말의 속도가 느려진다.
    - 많은 브로드캐스트를 처리해야 하므로 CPU 사용률이 높아진다.
2. 네트워크 접속 속도가 느려진다.
    - 거의 통신 불가능 수준이 된다.
3. 네트워크에 설치된 스위치에 모든 LED들이 동시에 빠른 속도로 깜빡인다.

루프가 만들어진 상황에서는 케이블을 제거하기 전까지 네트워크가 마비된 것 같은 상태가 지속된다.

---

### 스위치 MAC 러닝 중복 문제

루프 구조 상태에선 브로드캐스트 뿐만 아니라 유니캐스트도 문제를 일으킨다.

한 패킷이 루프를 돌아 같은 도착지에 중복 도착하는 문제가 발생할 수 있으며 중간에 있는 스위치에서도 **MAC 러닝 문제**가 발생한다.

스위치 MAC 주소 테이블에서는 하나의 MAC 주소에 대해 하나의 포트만 학습할 수 있으므로 동일한 MAC 주소가 여러 포트에 학습되면 MAC 테이블이 반복 갱신되어 정상적으로 동작하지 않는다.

이러한 현상을 **MAC 어드레스 플래핑(MAC Address Flapping)**이라고 부른다.

![Untitled](Ch_4%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%20b1b4e/Untitled%201.png)

> 스위치 MAC 주소 증복 문제
> 

이러한 현상이 발생하면 스위치에서 학습된 주소의 포트가 계속 변경되므로 스위치가 정상적으로 동작하지 못하고 패킷을 플러딩한다.

이러한 현상을 방지하기 위해 스위치 설정에 따라 <ul>경고 메세지를 관리자에게 </ul> 알려주거나 수시로 일어나는 <ul>플래핑 현상을 학습하지 않도록 자동 조치</ul>한다.

루프 구성 중 하나의 포트만 사용하지 못하도록 셧다운되어 있어도 루프를 예방할 수 있지만, 네트워크의 SPoF를 예방하기 위해 두 개 이상의 스위치로 디자인했는데 다시 수동으로 루프를 찾아 강제로 사용하지 못하게 하는 방법은 바람직하지 않다.

이런 이유로 루프를 자동 감지해 포트를 차단하고 장애 때문에 우회로가 없을 때 차단된 포트를 스위치 스스로 다시 풀어주는 **스패닝 트리 프로토콜**이 개발되었다.

![Untitled](Ch_4%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%20b1b4e/Untitled%202.png)

> 스패닝 트리 프로토콜으 장애가 발생하면 차단된 포트를 자동으로 복구한다.
> 

---

### STP란?

스패닝 트리 프로토콜(Spaaning Tree Protocol)은 루프를 확인하고 적절히 포트를 사용하지 못하게 만들어 **루프를 예방**하는 메커니즘이다.

스패닝 트리 프로토콜을 이용해 루프를 예방하려면 전체 스위치가 어떻게 연결되는지 알아야 한다.

전체적인 스위치 연결 상황을 파악하러면 스위치 간에 정보를 전달하는 방법이 필요하다.

이를 위해 스위치는 BPDU(Bridge Protocol Data Unit)라는 프로토콜을 통해 스위치간에 정보를 전달하고 이렇게 수집된 정보를 이용해 **전체 네트워크 트리**를 만들어 루프 구간을 확보한다.

BPDU에는 스위치가 갖고 있는 ID와 같은 고유값이 들어가고 이런 정보들이 스위치간에 서로 교환되면서 루프 파악이 가능해진다. 이렇게 확인된 루프 지점을 데이터 트래픽이 통과하지 못하도록 차단해 루프를 예방한다.

---

### 스위치 포트의 상태 및 변화 과정

STP가 동작 중인 스위치에서는 루프를 막기 위해 스위치 포트에 신규 스위치가 연결되면 바로 트래픽이 흐르지 않도록 차단한다. 그 후 해당 포트로 트래픽이 흘러도 되는지 확인하기 위해 BPDU를 기다려 학습하고 구조를 파악한 후 트래픽을 흘리거나 루프 구조인 경우, 차단 상태를 유지한다.

차단 상태에서 트래픽이 흐를 때까지 스위치 포트의 상태는 다음과 같다.

**Blocking**

- 패킷 데이터를 차단한 상태로 상대방이 보낸 BPDU를 기다린다.
- 총 20초인 Max Age 기간 동안 상대방 스위치에서 BPDU를 받지 못했거나 후순위 BPDU를 받았을 때 포트는 **리스닝 상태**로 변경된다.
    - BPDU 기본 교환 주기는 2초이고 10번의 BPDU를 기다린다.
    

**Listening**

- 해당 포트가 전송 상태로 변경이 되는 것을 결정하고 준비하는 단계이다.
- 이 상태부터는 자신의 BPDU 정보를 상대방에게 전송하기 시작한다.
- 총 15초 동안 대기한다.

**Learning**

- 러닝 상태는 이미 **해당 포트를 포워딩 하기로 결정**하고 실제 패킷 포워딩이 일어날 때 스위치가 곧바로 동작하도록 **MAC 주소를 러닝하는 단계**이다.
- 총 15초 동안 대기한다.

**Forwarding**

- 패킷을 포워딩하는 단계이다. 정상적인 통신이 가능하다.

이와 같은 단계를 거치기 때문에 스위치에 신규 장비를 붙이면 통신하는데 50여 초 가량 소모된다.

스위치는 루프를 예방하기 위해 매우 방어적으로 동작하는데 새로 연결된 단말이 스위치일 가능성이 있어 PBDU를 일정 시간 이상 기다려 스위치 여부를 파악한다.

이로 인해 스위치를 연결하는 경우 뿐만 아니라 일반 단말을 연결하더라도 동일한 시간이 걸린다.

![Untitled](Ch_4%20%E1%84%89%E1%85%B3%E1%84%8B%E1%85%B1%E1%84%8E%20b1b4e/Untitled%203.png)

> 기본 STP 상태 변화
> 

링크가 자신의 인터페이스인 경우, 포톨로지가 변했음을 직접 감지할 수 있어 MaxAge를 거치지 않고 리스닝부터 STP 상태 변화가 즉시 이루어 지므로 30초 만에 절체 된다.

**STP가 활성화된 경우, 스위치 포트는 곧바로 포워딩 상태가 되지 않는다.**

이로 인해 다양한 문제가 발생하거나 스위치 이상으로 생각되는 경우가 많다.

특히 부팅 시간이 매우 빠른 OS가 DHCP 네트워크에 접속할 때 부팅 단계에서 IP를 요청하지만 스위치 포트가 포워딩 상태가 되지 않아 IP를 정상적으로 할당받지 못하는 경우가 많다.

---